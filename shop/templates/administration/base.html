<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Admin - DSG General Trading{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: "#137fec",
                    }
                }
            }
        }
    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }

        /* Optimisations mobiles */
        @media (max-width: 640px) {
            input, button, select {
                font-size: 16px !important; /* Empêche le zoom sur iOS */
            }
        }

        /* Animation de focus améliorée */
        input:focus, select:focus, textarea:focus {
            transform: translateY(-1px);
            transition: all 0.2s ease;
        }

        /* Bouton tactile optimisé */
        button, a[role="button"] {
            min-height: 44px;
            touch-action: manipulation;
        }

        /* Styles pour la navigation fixe */
        .fixed-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 50;
        }

        .content-with-fixed-nav {
            margin-top: 64px; /* Hauteur de la navigation */
            min-height: calc(100vh - 64px);
        }

        /* Ajustement pour l'en-tête de page fixe */
        .page-header-fixed {
            position: sticky;
            top: 64px; /* Sous la navigation */
            z-index: 40;
        }

        /* Ajustement mobile pour la navigation fixe */
        @media (max-width: 640px) {
            .content-with-fixed-nav {
                margin-top: 56px; /* Hauteur réduite sur mobile */
            }

            .page-header-fixed {
                top: 56px; /* Ajusté pour mobile */
            }
        }

        /* Breakpoint personnalisé pour très petits écrans */
        @media (max-width: 475px) {
            .text-2xl {
                font-size: 1.5rem;
            }
            .text-xl {
                font-size: 1.25rem;
            }
        }

        /* Animation de spin pour le chargement */
        .animate-spin {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Amélioration de l'accessibilité */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Style pour les états désactivés */
        button:disabled, a[disabled] {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Optimisation pour très petits écrans */
        @media (max-width: 320px) {
            .px-4 {
                padding-left: 0.75rem;
                padding-right: 0.75rem;
            }
            .gap-3 {
                gap: 0.5rem;
            }
        }

        /* Amélioration de la lisibilité sur mobile */
        @media (max-width: 640px) {
            .bg-gray-50 {
                background-color: #f9fafb;
            }

            .leading-relaxed {
                line-height: 1.5;
            }
        }

        /* Styles pour le scroll fluide */
        html {
            scroll-behavior: smooth;
        }

        /* Ombre portée pour la navigation fixe */
        .fixed-nav {
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        /* Ombre pour l'en-tête de page fixe */
        .page-header-fixed {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        /* Empêche le contenu de déborder horizontalement */
        .max-width-safe {
            max-width: 100%;
            overflow-x: hidden;
        }
        /* Styles pour les badges de notification */
    .animate-pulse {
        animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    @keyframes pulse {
        0%, 100% {
            opacity: 1;
        }
        50% {
            opacity: 0.5;
        }
    }

    /* Ajustement pour les badges sur mobile */
    @media (max-width: 640px) {
        .absolute.-top-1.-right-1 {
            top: -2px;
            right: -2px;
            height: 18px;
            width: 18px;
            font-size: 10px;
        }
    }

    /* Effet de survol pour les liens avec badges */
    .relative:hover .animate-pulse {
        animation-duration: 1s;
    }
    </style>
</head>
<body class="font-sans bg-gray-100 max-width-safe">
    <nav class="fixed-nav bg-white shadow-sm border-b border-gray-200">
        <div class="px-4 sm:px-6 lg:px-8 max-width-safe">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center flex-shrink-0">
                    <button id="mobile-menu-button" class="md:hidden mr-4 text-gray-700">
                        <span class="material-symbols-outlined text-2xl">menu</span>
                    </button>

                    <a href="/gestion-securisee/dashboard/" class="flex items-center gap-3 whitespace-nowrap">
                        <span class="material-symbols-outlined text-primary text-2xl">admin_panel_settings</span>
                        <span class="text-xl font-bold text-gray-900 hidden sm:block">DSG Admin</span>
                    </a>
                </div>

                <div class="hidden md:flex items-center space-x-4 overflow-x-auto flex-1">
                    <a href="/gestion-securisee/dashboard/"
                       class="text-gray-700 hover:text-primary px-3 py-2 rounded-lg transition-colors flex items-center gap-2 whitespace-nowrap relative {% if request.path == '/gestion-securisee/dashboard/' %}bg-blue-50 text-primary font-medium{% endif %}">
                        <span class="material-symbols-outlined">dashboard</span>
                        Tableau de bord
                    </a>

                    <a href="/gestion-securisee/products/"
                       class="text-gray-700 hover:text-primary px-3 py-2 rounded-lg transition-colors flex items-center gap-2 whitespace-nowrap relative {% if request.path == '/gestion-securisee/products/' or request.path == '/gestion-securisee/products/add/' %}bg-blue-50 text-primary font-medium{% endif %}">
                        <span class="material-symbols-outlined">inventory_2</span>
                        Produits
                    </a>

                    <a href="/gestion-securisee/orders/"
                       class="text-gray-700 hover:text-primary px-3 py-2 rounded-lg transition-colors flex items-center gap-2 whitespace-nowrap relative {% if request.path == '/gestion-securisee/orders/' %}bg-blue-50 text-primary font-medium{% endif %}">
                        <span class="material-symbols-outlined">receipt_long</span>
                        Commandes
                        {% if pending_orders_count > 0 %}
                        <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center animate-pulse">
                            {{ pending_orders_count }}
                        </span>
                        {% endif %}
                    </a>

                    <a href="/gestion-securisee/custom-quotes/"
                       class="text-gray-700 hover:text-primary px-3 py-2 rounded-lg transition-colors flex items-center gap-2 whitespace-nowrap relative {% if request.path == '/gestion-securisee/custom-quotes/' %}bg-blue-50 text-primary font-medium{% endif %}">
                        <span class="material-symbols-outlined">request_quote</span>
                        Demandes Devis
                        {% if pending_quotes_count > 0 %}
                        <span class="absolute -top-1 -right-1 bg-orange-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center animate-pulse">
                            {{ pending_quotes_count }}
                        </span>
                        {% endif %}
                    </a>

                    <a href="/gestion-securisee/repairs/"
                       class="text-gray-700 hover:text-primary px-3 py-2 rounded-lg transition-colors flex items-center gap-2 whitespace-nowrap relative {% if request.path == '/gestion-securisee/repairs/' %}bg-blue-50 text-primary font-medium{% endif %}">
                        <span class="material-symbols-outlined">build</span>
                        Réparations
                        {% if pending_repairs_count > 0 %}
                        <span class="absolute -top-1 -right-1 bg-green-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center animate-pulse">
                            {{ pending_repairs_count }}
                        </span>
                        {% endif %}
                    </a>
                </div>

                <div class="flex items-center space-x-3 flex-shrink-0">
                    <span class="text-sm text-gray-700 hidden sm:block whitespace-nowrap">Bonjour, {% if user.is_authenticated %}{{ user.username }}{% else %}Admin{% endif %}</span>
                    <form method="post" action="/gestion-securisee/logout/">
                        {% csrf_token %}
                        <button type="submit"
                                class="text-gray-600 hover:text-red-600 transition-colors flex items-center gap-2 p-2 rounded-lg hover:bg-gray-100 whitespace-nowrap">
                            <span class="material-symbols-outlined">logout</span>
                            <span class="hidden sm:block">Déconnexion</span>
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <div id="mobile-menu" class="md:hidden border-t border-gray-200 hidden">
            <div class="px-2 pt-2 pb-3 space-y-1">
                <a href="/gestion-securisee/dashboard/"
                   class="text-gray-700 hover:text-primary block px-3 py-2 rounded-lg transition-colors flex items-center gap-2 {% if request.path == '/gestion-securisee/dashboard/' %}bg-blue-50 text-primary font-medium{% endif %}">
                    <span class="material-symbols-outlined">dashboard</span>
                    Tableau de bord
                </a>
                <a href="/gestion-securisee/products/"
                   class="text-gray-700 hover:text-primary block px-3 py-2 rounded-lg transition-colors flex items-center gap-2 {% if request.path == '/gestion-securisee/products/' or request.path == '/gestion-securisee/products/add/' %}bg-blue-50 text-primary font-medium{% endif %}">
                    <span class="material-symbols-outlined">inventory_2</span>
                    Produits
                </a>
                <a href="/gestion-securisee/orders/"
                   class="text-gray-700 hover:text-primary block px-3 py-2 rounded-lg transition-colors flex items-center gap-2 relative {% if request.path == '/gestion-securisee/orders/' %}bg-blue-50 text-primary font-medium{% endif %}">
                    <span class="material-symbols-outlined">receipt_long</span>
                    Commandes
                    {% if pending_orders_count > 0 %}
                    <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center animate-pulse">
                        {{ pending_orders_count }}
                    </span>
                    {% endif %}
                </a>
                <a href="/gestion-securisee/custom-quotes/"
                   class="text-gray-700 hover:text-primary block px-3 py-2 rounded-lg transition-colors flex items-center gap-2 relative {% if request.path == '/gestion-securisee/custom-quotes/' %}bg-blue-50 text-primary font-medium{% endif %}">
                    <span class="material-symbols-outlined">request_quote</span>
                    Demandes Devis
                    {% if pending_quotes_count > 0 %}
                    <span class="absolute -top-1 -right-1 bg-orange-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center animate-pulse">
                        {{ pending_quotes_count }}
                    </span>
                    {% endif %}
                </a>
                <a href="/gestion-securisee/repairs/"
                   class="text-gray-700 hover:text-primary block px-3 py-2 rounded-lg transition-colors flex items-center gap-2 relative {% if request.path == '/gestion-securisee/repairs/' %}bg-blue-50 text-primary font-medium{% endif %}">
                    <span class="material-symbols-outlined">build</span>
                    Réparations
                    {% if pending_repairs_count > 0 %}
                    <span class="absolute -top-1 -right-1 bg-green-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center animate-pulse">
                        {{ pending_repairs_count }}
                    </span>
                    {% endif %}
                </a>
            </div>
        </div>
    </nav>

    <div class="content-with-fixed-nav">
        <div class="page-header-fixed bg-white shadow-sm border-b border-gray-200">
            <div class="px-4 sm:px-6 lg:px-8 py-6">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                    <div class="flex-1 min-w-0">
                        <h1 class="text-2xl sm:text-3xl font-bold text-gray-900">
                            {% block page_title %}Tableau de bord{% endblock %}
                        </h1>
                        <p class="text-sm sm:text-base text-gray-600 mt-1">
                            {% block page_subtitle %}Vue d'ensemble de votre activité{% endblock %}
                        </p>
                    </div>
                    <div class="mt-4 sm:mt-0 flex-shrink-0">
                        {% block page_actions %}
                        {% endblock %}
                    </div>
                </div>
            </div>
        </div>

        <main class="px-4 sm:px-6 lg:px-8 py-6 max-width-safe">
            {% if messages %}
            <div class="mb-6 space-y-3">
                {% for message in messages %}
                <div class="p-4 rounded-lg {% if message.tags == 'error' %}bg-red-50 border border-red-200 text-red-700
                                          {% elif message.tags == 'success' %}bg-green-50 border border-green-200 text-green-700
                                          {% elif message.tags == 'warning' %}bg-yellow-50 border border-yellow-200 text-yellow-700
                                          {% else %}bg-blue-50 border border-blue-200 text-blue-700{% endif %}">
                    <div class="flex items-center">
                        <span class="material-symbols-outlined mr-2 text-base flex-shrink-0">
                            {% if message.tags == 'error' %}error
                            {% elif message.tags == 'success' %}check_circle
                            {% elif message.tags == 'warning' %}warning
                            {% else %}info{% endif %}
                        </span>
                        <span class="text-sm">{{ message }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            {% block content %}
            {% endblock %}
        </main>
    </div>

    {% block extra_js %}
    {% endblock %}

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Animation au chargement des pages
        const mainContent = document.querySelector('main');
        if (mainContent) {
            mainContent.style.opacity = '0';
            mainContent.style.transform = 'translateY(10px)';

            setTimeout(() => {
                mainContent.style.transition = 'all 0.3s ease';
                mainContent.style.opacity = '1';
                mainContent.style.transform = 'translateY(0)';
            }, 100);
        }

        // Optimisation mobile
        if (window.innerWidth <= 768) {
            // Empêcher le zoom sur les inputs
            const inputs = document.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    this.style.fontSize = '16px';
                });
            });

            // Feedback tactile pour les boutons
            const buttons = document.querySelectorAll('button, a[role="button"]');
            buttons.forEach(button => {
                if (!button.disabled) {
                    button.addEventListener('touchstart', function() {
                        this.style.transform = 'scale(0.98)';
                    });
                    button.addEventListener('touchend', function() {
                        this.style.transform = 'scale(1)';
                    });
                }
            });
        }

        // Gestion des formulaires avec indicateur de chargement
        const forms = document.querySelectorAll('form');
        forms.forEach(form => {
            form.addEventListener('submit', function(e) {
                const submitButton = this.querySelector('button[type="submit"]');
                if (submitButton && !submitButton.disabled) {
                    const originalHTML = submitButton.innerHTML;
                    submitButton.innerHTML = '<span class="material-symbols-outlined animate-spin">refresh</span> Traitement...';
                    submitButton.disabled = true;

                    // Timeout de sécurité
                    setTimeout(() => {
                        if (submitButton.disabled) {
                            submitButton.innerHTML = originalHTML;
                            submitButton.disabled = false;
                        }
                    }, 10000);
                }
            });
        });
    });
    document.addEventListener('DOMContentLoaded', function() {
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');

        if (mobileMenuButton && mobileMenu) {
            mobileMenuButton.addEventListener('click', function() {
                if (mobileMenu.classList.contains('hidden')) {
                    mobileMenu.classList.remove('hidden');
                } else {
                    mobileMenu.classList.add('hidden');
                }
            });
        }
    });
    function updateNotificationBadges() {
    fetch('/gestion-securisee/dashboard/')
        .then(response => response.text())
        .then(html => {
            // Met à jour les badges (simplifié - en vrai tu ferais une API)
            console.log('Badges mis à jour');
        })
        .catch(error => console.log('Erreur mise à jour badges:', error));
    }
    setInterval(updateNotificationBadges, 30000);

    // Fonction utilitaire pour formater les prix
    window.formatPrice = function(price) {
        return new Intl.NumberFormat('fr-FR', {
            style: 'currency',
            currency: 'EUR'
        }).format(price);
    };

    // Fonction pour formater les dates
    window.formatDate = function(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('fr-FR', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric'
        });
    };
    </script>
</body>
</html>