{% extends 'shop/base.html' %}

{% block title %}{{ product.name }}{% endblock %}

{% block content %}
<!-- Fil d'ariane -->
<nav class="bg-white border-b border-slate-200">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-3 sm:py-4">
        <div class="flex items-center gap-2 text-xs sm:text-sm text-slate-500">
            <a href="{% url 'shop:home' %}" class="hover:text-primary transition-colors">Accueil</a>
            <span class="material-symbols-outlined text-xs">chevron_right</span>
            {% if product.product_type == 'SHEET' %}
                <a href="{% url 'shop:sheets_list' %}" class="hover:text-primary transition-colors">Draps</a>
            {% elif product.product_type == 'PHONE' %}
                <a href="{% url 'shop:phones_list' %}" class="hover:text-primary transition-colors">T√©l√©phones</a>
            {% endif %}
            <span class="material-symbols-outlined text-xs">chevron_right</span>
            <span class="text-slate-800 font-medium truncate">{{ product.name }}</span>
        </div>
    </div>
</nav>

<!-- MAIN CONTENT -->
<div class="container mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8">
    <div class="max-w-6xl mx-auto">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-8 xl:gap-12">

            <!-- IMAGE PRINCIPALE -->
            <div class="space-y-3 sm:space-y-4">
                <div class="bg-white rounded-lg overflow-hidden border border-slate-200">
                    {% if product.image %}
                        <img src="{{ product.image.url }}" alt="{{ product.name }}"
                             class="w-full h-64 sm:h-72 lg:h-80 xl:h-96 object-cover hover:scale-105 transition-transform duration-300">
                    {% else %}
                        <div class="w-full h-64 sm:h-72 lg:h-80 xl:h-96 bg-slate-100 flex items-center justify-center">
                            <span class="text-4xl sm:text-5xl text-slate-400">
                                {% if product.product_type == 'SHEET' %}üõèÔ∏è
                                {% elif product.product_type == 'PHONE' %}üì±
                                {% else %}üîß{% endif %}
                            </span>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- INFORMATIONS PRODUIT -->
            <div class="space-y-4 sm:space-y-6">
                <!-- En-t√™te produit -->
                <div class="space-y-2 sm:space-y-3">
                    <div class="flex items-start justify-between">
                        <h1 class="text-xl sm:text-2xl lg:text-3xl font-bold text-slate-900 pr-4">{{ product.name }}</h1>
                        {% if product.on_sale %}
                        <span class="bg-red-500 text-white text-xs sm:text-sm font-bold px-2 sm:px-3 py-1 rounded-full shrink-0">
                            -{{ product.discount_percentage }}%
                        </span>
                        {% endif %}
                    </div>

                    <!-- Badges compacts -->
                    <div class="flex flex-wrap gap-1 sm:gap-2">
                        {% if product.product_type == 'SHEET' and product.sheet_size %}
                        <span class="bg-blue-50 text-blue-700 text-xs font-medium px-2 py-1 rounded">
                            {{ product.get_sheet_size_display }}
                        </span>
                        {% endif %}
                        {% if product.color %}
                        <span class="bg-slate-100 text-slate-700 text-xs font-medium px-2 py-1 rounded">
                            {{ product.get_color_display }}
                        </span>
                        {% endif %}
                        {% if product.phone_brand %}
                        <span class="bg-purple-50 text-purple-700 text-xs font-medium px-2 py-1 rounded">
                            {{ product.get_phone_brand_display }}
                        </span>
                        {% endif %}
                    </div>
                </div>

                <!-- Prix et stock -->
                <div class="space-y-2">
                    <div class="flex items-center gap-2 sm:gap-3">
                        {% if product.on_sale %}
                            <span class="text-2xl sm:text-3xl font-bold text-primary">{{ product.get_discounted_price|floatformat:2 }} FCFA</span>
                            <span class="text-base sm:text-lg text-red-500 line-through">{{ product.price|floatformat:2 }} FCFA</span>
                        {% else %}
                            <span class="text-2xl sm:text-3xl font-bold text-slate-900">{{ product.price|floatformat:2 }} FCFA</span>
                        {% endif %}
                        <span class="text-xs sm:text-sm text-slate-500">TTC</span>
                    </div>

                    <div class="flex items-center gap-2 text-xs sm:text-sm">
                        {% if product.stock > 0 %}
                            <span class="material-symbols-outlined text-green-500 text-sm sm:text-base">check_circle</span>
                            <span class="text-green-600 font-medium">En stock</span>
                            <span class="text-slate-500">‚Ä¢ {{ product.stock }} disponibles</span>
                        {% else %}
                            <span class="material-symbols-outlined text-red-500 text-sm sm:text-base">cancel</span>
                            <span class="text-red-600 font-medium">Rupture de stock</span>
                        {% endif %}
                    </div>
                </div>

                <!-- Description courte -->
                <div class="prose prose-sm max-w-none">
                    <p class="text-slate-600 leading-relaxed text-sm sm:text-base">{{ product.description }}</p>
                </div>

                <!-- Actions principales -->
                <div class="space-y-3">
                    {% if product.stock > 0 %}
                        <button type="button"
                                data-add-to-cart
                                data-product-id="{{ product.id }}"
                                class="w-full bg-primary text-white font-semibold py-2 sm:py-3 px-4 sm:px-6 rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2 text-sm sm:text-base">
                            <span class="material-symbols-outlined text-lg">shopping_cart</span>
                            Ajouter au panier
                        </button>
                    {% else %}
                        <button class="w-full bg-slate-300 text-slate-500 font-semibold py-2 sm:py-3 px-4 sm:px-6 rounded-lg cursor-not-allowed text-sm sm:text-base" disabled>
                            Produit indisponible
                        </button>
                    {% endif %}
                </div>

                <!-- Livraison et garantie -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 text-xs sm:text-sm text-slate-600">
                    <div class="flex items-center gap-2">
                        <span class="material-symbols-outlined text-green-500 text-sm sm:text-base">local_shipping</span>
                        <span>Livraison gratuite</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="material-symbols-outlined text-blue-500 text-sm sm:text-base">verified</span>
                        <span>Garantie 2 ans</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION D√âTAILS AVEC ONGLETS -->
        <div class="mt-6 sm:mt-8 lg:mt-12">
            <div class="border-b border-slate-200 overflow-x-auto">
                <nav class="flex gap-4 sm:gap-6 lg:gap-8 -mb-px min-w-max">
                    <button class="pb-3 border-b-2 border-primary text-primary font-medium text-xs sm:text-sm transition-colors whitespace-nowrap" data-tab="specs">
                        Sp√©cifications
                    </button>
                    <button class="pb-3 border-b-2 border-transparent text-slate-500 hover:text-slate-700 font-medium text-xs sm:text-sm transition-colors whitespace-nowrap" data-tab="description">
                        Description
                    </button>
                </nav>
            </div>

            <div class="py-4 sm:py-6">
                <!-- Onglet Sp√©cifications -->
                <div id="specs-tab" class="tab-content">
                    {% if product.product_type == 'PHONE' %}
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4">
                        {% if product.screen_size %}
                        <div class="bg-white rounded-lg p-3 sm:p-4 border border-slate-200">
                            <div class="text-slate-500 text-xs sm:text-sm mb-1">√âcran</div>
                            <div class="font-medium text-slate-900 text-sm sm:text-base">{{ product.screen_size }}</div>
                        </div>
                        {% endif %}

                        {% if product.processor %}
                        <div class="bg-white rounded-lg p-3 sm:p-4 border border-slate-200">
                            <div class="text-slate-500 text-xs sm:text-sm mb-1">Processeur</div>
                            <div class="font-medium text-slate-900 text-sm sm:text-base">{{ product.processor }}</div>
                        </div>
                        {% endif %}

                        {% if product.camera %}
                        <div class="bg-white rounded-lg p-3 sm:p-4 border border-slate-200">
                            <div class="text-slate-500 text-xs sm:text-sm mb-1">Appareil photo</div>
                            <div class="font-medium text-slate-900 text-sm sm:text-base">{{ product.camera }}</div>
                        </div>
                        {% endif %}

                        {% if product.storage %}
                        <div class="bg-white rounded-lg p-3 sm:p-4 border border-slate-200">
                            <div class="text-slate-500 text-xs sm:text-sm mb-1">Stockage</div>
                            <div class="font-medium text-slate-900 text-sm sm:text-base">{{ product.storage }}</div>
                        </div>
                        {% endif %}

                        {% if product.ram %}
                        <div class="bg-white rounded-lg p-3 sm:p-4 border border-slate-200">
                            <div class="text-slate-500 text-xs sm:text-sm mb-1">M√©moire RAM</div>
                            <div class="font-medium text-slate-900 text-sm sm:text-base">{{ product.ram }}</div>
                        </div>
                        {% endif %}

                        {% if product.battery %}
                        <div class="bg-white rounded-lg p-3 sm:p-4 border border-slate-200">
                            <div class="text-slate-500 text-xs sm:text-sm mb-1">Batterie</div>
                            <div class="font-medium text-slate-900 text-sm sm:text-base">{{ product.battery }}</div>
                        </div>
                        {% endif %}

                        {% if product.operating_system %}
                        <div class="bg-white rounded-lg p-3 sm:p-4 border border-slate-200">
                            <div class="text-slate-500 text-xs sm:text-sm mb-1">Syst√®me</div>
                            <div class="font-medium text-slate-900 text-sm sm:text-base">{{ product.operating_system }}</div>
                        </div>
                        {% endif %}
                    </div>

                    {% elif product.product_type == 'SHEET' %}
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 max-w-2xl">
                        {% if product.material %}
                        <div class="flex justify-between py-2 border-b border-slate-100">
                            <span class="text-slate-600 text-sm">Mati√®re</span>
                            <span class="font-medium text-slate-900 text-sm">{{ product.material }}</span>
                        </div>
                        {% endif %}
                        {% if product.sheet_size %}
                        <div class="flex justify-between py-2 border-b border-slate-100">
                            <span class="text-slate-600 text-sm">Taille</span>
                            <span class="font-medium text-slate-900 text-sm">{{ product.get_sheet_size_display }}</span>
                        </div>
                        {% endif %}
                        {% if product.color %}
                        <div class="flex justify-between py-2 border-b border-slate-100">
                            <span class="text-slate-600 text-sm">Couleur</span>
                            <span class="font-medium text-slate-900 text-sm">{{ product.get_color_display }}</span>
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>

                <!-- Onglet Description -->
                <div id="description-tab" class="tab-content hidden">
                    <div class="prose prose-sm sm:prose-base max-w-none">
                        <p class="text-slate-600 leading-relaxed">{{ product.description }}</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- PRODUITS SIMILAIRES COMPACTS -->
        {% if similar_products %}
        <section class="mt-8 sm:mt-12">
            <div class="flex items-center justify-between mb-4 sm:mb-6">
                <h2 class="text-lg sm:text-xl font-bold text-slate-900">Produits similaires</h2>
                <a href="{% if product.product_type == 'SHEET' %}{% url 'shop:sheets_list' %}{% else %}{% url 'shop:phones_list' %}{% endif %}"
                   class="text-primary hover:underline text-xs sm:text-sm">
                    Voir tout
                </a>
            </div>
            <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-4">
                {% for similar in similar_products %}
                <a href="{% url 'shop:product_detail' product_id=similar.id %}" class="bg-white rounded-lg overflow-hidden border border-slate-200 hover:border-primary transition-colors group">
                    <div class="relative">
                        {% if similar.image %}
                            <img src="{{ similar.image.url }}" alt="{{ similar.name }}" class="w-full h-32 sm:h-36 lg:h-40 object-cover group-hover:scale-105 transition-transform duration-300">
                        {% else %}
                            <div class="w-full h-32 sm:h-36 lg:h-40 bg-slate-100 flex items-center justify-center">
                                <span class="text-2xl sm:text-3xl text-slate-400">
                                    {% if similar.product_type == 'SHEET' %}üõèÔ∏è
                                    {% elif similar.product_type == 'PHONE' %}üì±
                                    {% else %}üîß{% endif %}
                                </span>
                            </div>
                        {% endif %}
                    </div>
                    <div class="p-2 sm:p-3">
                        <h3 class="font-medium text-slate-800 text-xs sm:text-sm mb-1 line-clamp-2 group-hover:text-primary transition-colors">{{ similar.name }}</h3>
                        <div class="flex items-center gap-1 sm:gap-2">
                            {% if similar.on_sale %}
                                <span class="text-sm sm:text-base font-bold text-primary">{{ similar.get_discounted_price|floatformat:2 }} FCFA</span>
                                <span class="text-xs text-red-500 line-through">{{ similar.price|floatformat:2 }} FCFA</span>
                            {% else %}
                                <span class="text-sm sm:text-base font-bold text-slate-900">{{ similar.price|floatformat:2 }} FCFA</span>
                            {% endif %}
                        </div>
                    </div>
                </a>
                {% endfor %}
            </div>
        </section>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Gestion des onglets
function showTab(tabName) {
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.add('hidden');
    });
    document.getElementById(tabName + '-tab').classList.remove('hidden');

    document.querySelectorAll('nav button').forEach(button => {
        button.classList.remove('border-primary', 'text-primary');
        button.classList.add('border-transparent', 'text-slate-500');
    });

    document.querySelector(`[data-tab="${tabName}"]`).classList.add('border-primary', 'text-primary');
    document.querySelector(`[data-tab="${tabName}"]`).classList.remove('border-transparent', 'text-slate-500');
}

// Initialisation au chargement de la page
document.addEventListener('DOMContentLoaded', function() {
    showTab('specs');

    // √âcouteurs d'√©v√©nements pour les onglets
    document.querySelectorAll('[data-tab]').forEach(button => {
        button.addEventListener('click', function() {
            const tabName = this.getAttribute('data-tab');
            showTab(tabName);
        });
    });

    // Les boutons "Ajouter au panier" sont g√©r√©s automatiquement par base.html
});
</script>

<style>
/* Pour les tr√®s petits √©crans */
@media (max-width: 480px) {
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .truncate {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
}

/* Scroll horizontal pour les onglets sur mobile */
.overflow-x-auto {
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
}

.overflow-x-auto::-webkit-scrollbar {
    display: none;
}
</style>
{% endblock %}