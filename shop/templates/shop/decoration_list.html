{% extends 'shop/base.html' %}
{% load static %}

{% block title %}D√©co & Am√©nagement Int√©rieur - DSD General Trading{% endblock %}

{% block description %}D√©couvrez notre collection d'articles de d√©coration d'int√©rieur : draps sur mesure, rideaux personnalis√©s, tapis et accessoires. Service de devis personnalis√© gratuit.{% endblock %}

{% block content %}
<div class="container mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8 lg:py-12">
    
    <!-- EN-T√äTE -->
    <div class="text-center mb-8 sm:mb-12">
        <h1 class="text-2xl sm:text-3xl lg:text-4xl font-bold text-slate-900 mb-4">D√©co & Am√©nagement Int√©rieur</h1>
        <p class="text-base sm:text-lg text-slate-600 max-w-2xl mx-auto">
            Transformez votre int√©rieur avec nos articles de d√©coration sur mesure. Draps, rideaux, tapis et bien plus.
        </p>
    </div>

    <!-- FILTRES -->
    <div class="bg-white rounded-2xl p-4 sm:p-6 mb-6 sm:mb-8 shadow-sm border border-slate-200">
        <div class="flex flex-col lg:flex-row gap-4 sm:gap-6 items-start lg:items-center justify-between">
            <!-- Filtres par type -->
            <div class="flex flex-wrap gap-2 sm:gap-3">
                <a href="{% url 'shop:decoration_list' %}" 
                   class="px-3 sm:px-4 py-2 rounded-lg text-sm font-medium transition-colors {% if not selected_type %}bg-primary text-white{% else %}bg-slate-100 text-slate-700 hover:bg-slate-200{% endif %}">
                    Tous
                </a>
                {% for type_value, type_name in decoration_types %}
                <a href="{% url 'shop:decoration_list' %}?type={{ type_value }}" 
                   class="px-3 sm:px-4 py-2 rounded-lg text-sm font-medium transition-colors {% if selected_type == type_value %}bg-primary text-white{% else %}bg-slate-100 text-slate-700 hover:bg-slate-200{% endif %}">
                    {{ type_name }}
                </a>
                {% endfor %}
            </div>

            <!-- Filtres par type de prix -->
            <div class="flex flex-wrap gap-2 sm:gap-3">
                <a href="{% url 'shop:decoration_list' %}" 
                   class="px-3 sm:px-4 py-2 rounded-lg text-sm font-medium transition-colors {% if not selected_quote_filter %}bg-green-100 text-green-700 border border-green-200{% else %}bg-slate-100 text-slate-700 hover:bg-slate-200{% endif %}">
                    Tous les produits
                </a>
                <a href="{% url 'shop:decoration_list' %}?needs_quote=standard" 
                   class="px-3 sm:px-4 py-2 rounded-lg text-sm font-medium transition-colors {% if selected_quote_filter == 'standard' %}bg-blue-100 text-blue-700 border border-blue-200{% else %}bg-slate-100 text-slate-700 hover:bg-slate-200{% endif %}">
                    Prix fixes
                </a>
                <a href="{% url 'shop:decoration_list' %}?needs_quote=custom" 
                   class="px-3 sm:px-4 py-2 rounded-lg text-sm font-medium transition-colors {% if selected_quote_filter == 'custom' %}bg-orange-100 text-orange-700 border border-orange-200{% else %}bg-slate-100 text-slate-700 hover:bg-slate-200{% endif %}">
                    Sur devis
                </a>
            </div>

            <!-- Tri -->
            <div class="flex items-center gap-2">
                <span class="text-sm text-slate-600 font-medium hidden sm:block">Trier par :</span>
                <select onchange="window.location.href = '{% url 'shop:decoration_list' %}?sort=' + this.value" 
                        class="border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary focus:border-primary">
                    <option value="">Nouveaut√©s</option>
                    <option value="price_asc" {% if sort_by == 'price_asc' %}selected{% endif %}>Prix croissant</option>
                    <option value="price_desc" {% if sort_by == 'price_desc' %}selected{% endif %}>Prix d√©croissant</option>
                    <option value="new" {% if sort_by == 'new' %}selected{% endif %}>Plus r√©cents</option>
                </select>
            </div>
        </div>
    </div>

    <!-- LISTE DES PRODUITS -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6">
        {% for product in decorations %}
        <div class="bg-white border border-slate-200 rounded-2xl overflow-hidden group hover:shadow-xl transition-all duration-300">
            <div class="relative overflow-hidden">
                {% if product.image %}
                    <img src="{{ product.image.url }}" alt="{{ product.name }}"
                         class="w-full h-48 sm:h-56 object-cover group-hover:scale-105 transition-transform duration-500">
                {% else %}
                    <div class="w-full h-48 sm:h-56 bg-gradient-to-br from-slate-100 to-slate-200 flex items-center justify-center">
                        <span class="text-4xl text-slate-400">
                            {% if product.decoration_type == 'SHEET' %}üõèÔ∏è
                            {% elif product.decoration_type == 'CURTAIN' %}ü™ü
                            {% elif product.decoration_type == 'CARPET' %}üß∂
                            {% else %}üè†{% endif %}
                        </span>
                    </div>
                {% endif %}

                <!-- BADGES -->
                <div class="absolute top-3 left-3 flex flex-col gap-1">
                    {% if product.needs_custom_quote %}
                    <span class="bg-orange-500 text-white font-bold px-2 sm:px-3 py-1 rounded-full text-xs sm:text-sm shadow-lg">
                        Sur devis
                    </span>
                    {% endif %}
                    
                    {% if product.on_sale %}
                    <span class="bg-red-500 text-white font-bold px-2 sm:px-3 py-1 rounded-full text-xs sm:text-sm shadow-lg">
                        -{{ product.discount_percentage }}%
                    </span>
                    {% endif %}
                </div>

                <!-- TYPE DE PRODUIT -->
                <div class="absolute top-3 right-3">
                    <span class="bg-white/90 backdrop-blur-sm text-slate-700 text-xs font-medium px-2 py-1 rounded">
                        {{ product.get_decoration_type_display }}
                    </span>
                </div>
            </div>

            <div class="p-4 sm:p-6">
                <div class="mb-3">
                    <h3 class="font-bold text-base sm:text-lg text-slate-900 mb-2 line-clamp-2">{{ product.name }}</h3>
                    <p class="text-xs sm:text-sm text-slate-500 line-clamp-2">{{ product.description|truncatewords:20 }}</p>
                </div>

                <!-- PRIX -->
                <div class="mb-4">
                    {% if product.needs_custom_quote %}
                        <div class="text-lg sm:text-xl font-bold text-orange-600">Sur devis personnalis√©</div>
                        <p class="text-xs sm:text-sm text-slate-500 mt-1">Prix selon vos dimensions et besoins</p>
                    {% else %}
                        {% if product.on_sale %}
                            <div class="flex items-center gap-2">
                                <span class="text-lg sm:text-xl font-bold text-primary">{{ product.get_discounted_price|floatformat:2 }} FCFA</span>
                                <span class="text-sm text-red-500 line-through">{{ product.price|floatformat:2 }} FCFA</span>
                            </div>
                        {% else %}
                            <span class="text-lg sm:text-xl font-bold text-slate-900">{{ product.price|floatformat:2 }} FCFA</span>
                        {% endif %}
                        
                        {% if product.decoration_type == 'CARPET' and product.price_per_sqm %}
                            <p class="text-xs text-slate-500 mt-1">{{ product.price_per_sqm|floatformat:2 }} FCFA/m¬≤</p>
                        {% endif %}
                    {% endif %}
                </div>

                <!-- BOUTONS D'ACTION -->
                <div class="flex gap-2">
                    {% if product.needs_custom_quote %}
                        <!-- Produit sur devis - Pas de d√©tails, directement vers devis -->
                        <a class="flex-1 bg-orange-500 text-white font-medium py-2 px-3 sm:px-4 rounded-lg hover:bg-orange-600 transition-colors text-xs sm:text-sm text-center flex items-center justify-center gap-1"
                           href="{% url 'shop:custom_quote_request' product_id=product.id %}">
                            <span class="material-symbols-outlined text-sm">request_quote</span>
                            Demander un devis
                        </a>
                    {% else %}
                        <!-- Produit standard - D√©tails + Ajouter au panier -->
                        <a class="flex-1 bg-slate-100 text-slate-700 font-medium py-2 px-3 sm:px-4 rounded-lg hover:bg-slate-200 transition-colors text-xs sm:text-sm text-center"
                           href="{% url 'shop:product_detail' product_id=product.id %}">
                            Voir d√©tails
                        </a>

                        {% if product.stock > 0 %}
                            <button type="button"
                                    data-add-to-cart
                                    data-product-id="{{ product.id }}"
                                    class="flex-1 bg-primary text-white font-medium py-2 px-3 sm:px-4 rounded-lg hover:bg-blue-700 transition-colors text-xs sm:text-sm flex items-center justify-center gap-1">
                                <span class="material-symbols-outlined text-sm">shopping_cart</span>
                                Ajouter
                            </button>
                        {% else %}
                            <button class="flex-1 bg-slate-300 text-slate-500 font-medium py-2 px-3 sm:px-4 rounded-lg text-xs sm:text-sm cursor-not-allowed" disabled>
                                Indisponible
                            </button>
                        {% endif %}
                    {% endif %}
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-span-1 sm:col-span-2 lg:col-span-3 xl:col-span-4 text-center py-12 sm:py-16">
            <div class="max-w-md mx-auto">
                <span class="material-symbols-outlined text-4xl sm:text-6xl text-slate-300 mb-4">home</span>
                <h3 class="text-lg sm:text-xl font-semibold text-slate-700 mb-2">Aucun article trouv√©</h3>
                <p class="text-slate-500 mb-6 text-sm sm:text-base">
                    {% if selected_type or selected_quote_filter %}
                        Aucun article ne correspond √† vos crit√®res de filtrage.
                    {% else %}
                        Aucun article de d√©coration n'est disponible pour le moment.
                    {% endif %}
                </p>
                <a href="{% url 'shop:decoration_list' %}" class="text-primary hover:underline font-medium text-sm sm:text-base">
                    Voir tous les articles
                </a>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- INFORMATION SUR LES DEVIS -->
    {% if decorations|length > 0 %}
    <div class="mt-8 sm:mt-12 bg-blue-50 border border-blue-200 rounded-2xl p-6 sm:p-8">
        <div class="flex items-start gap-4">
            <span class="material-symbols-outlined text-blue-600 text-2xl sm:text-3xl">info</span>
            <div>
                <h3 class="font-bold text-blue-900 text-lg sm:text-xl mb-2">Service de devis personnalis√©</h3>
                <p class="text-blue-800 text-sm sm:text-base mb-3">
                    Pour les articles marqu√©s "Sur devis", notre √©quipe d'experts se d√©place gratuitement √† votre domicile 
                    pour prendre les mesures et vous proposer un devis personnalis√© adapt√© √† vos besoins et √† votre espace.
                </p>
                <ul class="text-blue-700 text-sm space-y-1">
                    <li class="flex items-center gap-2">
                        <span class="material-symbols-outlined text-sm">check</span>
                        <span>Visite √† domicile gratuite</span>
                    </li>
                    <li class="flex items-center gap-2">
                        <span class="material-symbols-outlined text-sm">check</span>
                        <span>Conseils d'experts en d√©coration</span>
                    </li>
                    <li class="flex items-center gap-2">
                        <span class="material-symbols-outlined text-sm">check</span>
                        <span>Devis d√©taill√© sans engagement</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // R√©initialiser les boutons "Ajouter au panier"
    setTimeout(() => {
        if (typeof initAddToCartButtons === 'function') {
            initAddToCartButtons();
        }
    }, 100);
});
</script>
{% endblock %}